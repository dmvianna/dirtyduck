model_comment: 'inspections'

temporal_config:
  beginning_of_time: '2010-01-04' # earliest date included in features
  modeling_start_time: '2014-01-01' # earliest date in any model
  modeling_end_time: '2017-01-01' # all dates in any model are < this date

  update_window: '1 y' # how frequently to retrain models

  train_example_frequency: '1 d' # time between rows for same entity in train matrix
  train_durations: ['1 y'] # length of time included in a train matrix
  train_label_windows: ['3 month'] # time period across which outcomes are labeled in train matrices

  test_example_frequency: '1 d' # time between rows for same entity in test matrix
  test_durations: ['1 d'] # length of time included in a test matrix
  test_label_windows: ['3 month'] # time period across which outcomes are labeled in test matrices

events_table: 'inspections_events'

feature_aggregations:
  -
    # Number of violations of a specific code and proportion, grouped by entity
    prefix: 'violations'
    from_obj: 'cleaned.violations'
    knowledge_date_column: 'knowledge_date'

    categoricals:
      -
        column: 'violation_code'
        choice_query: 'select distinct violation_code from cleaned.violations'
        metrics:
          - 'sum'
          - 'avg'

    intervals:
      - '1 y'

    groups:
      - 'entity_id'

  -  # inspections in the last year associated with this entity
    prefix: 'inspections'
    from_obj: 'cleaned.inspections'
    knowledge_date_column: 'date'
    aggregates:
      -
          quantity: '*'
          metrics:
              - 'count'
    intervals:
      - '1 y'

    groups:
      - 'license_num'

  - # inspections that happened in the last year grouped  by type of facility
    prefix: 'inspections'
    from_obj: 'cleaned.inspections'
    knowledge_date_column: 'date'

    aggregates:
      -
          quantity: '*'
          metrics:
              - 'count'
    intervals:
      - '1 y'

    groups:
      - 'facility_type'

  - # inspections that happened in the last year grouped  by zip code
    prefix: 'inspections'
    from_obj: 'cleaned.inspections'
    knowledge_date_column: 'date'

    aggregates:
      -
          quantity: '*'
          metrics:
              - 'count'
    intervals:
      - '1 y'

    groups:
      - 'zip_code'

feature_group_strategies: ['all']

model_group_keys: []

grid_config:
  'sklearn.tree.DecisionTreeClassifier':
    criterion: ['gini']
    max_depth: [3]
    min_samples_split: [10]

scoring:
  metric_groups:
    -
      metrics: ['precision@', 'recall@', 'fpr@']
      thresholds:
        percentiles: [1.0, 2.0, 5.0, 10.0, 25.0]
        top_n: [25, 75, 150, 300, 500, 1000, 1500]
